<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="scripts/ws-control.js" defer ></script>
    </head>
    <body>
        <div class="zone1" onclick="sendWS('s38_z1')">
            2 Bateaux à Gauche de la scène
            <div class="zone11" onclick="sendWS('s38_z1_1')">
                <!-- Zone1.2-->
                 
            </div>
            <div class="zone12" onclick="sendWS('s38_z1_2')">
                <!-- Zone1.2-->
                 
            </div>
        </div>
        <div class="zone2" onclick="sendWS('s38_z2')">
            Grande flotte principale, de 5 bateaux, avec le bateau de Guillaume à gauche.
            <!--<div class="zone21" onclick="sendWS('s38_z2_1')">
            
                 Petit bateau à gauche pour donner un effet de profondeur
            </div>-->

            <a class="zone22" onclick="sendWS('sG');window.location.href='BateauGuillaume.html'">Bateau Guillaume</a>
            
            <!--<div class="zone22" onclick="sendWS('s38_z2_2')">
                
                 Bateau de Guillaume
                 
                 div class="zone221" onclick="sendWS('s38_z2_1')">
              
                     Petit bateau derrière le bateau de guillaume pour donner un effet de profondeur
                </div>
                 <div class="zone222" onclick="sendWS('s38_z2_2_2')">
                    
                     Lanterne en haut de la voile, elle montre le chemin au reste de la flotte
                     
                </div>

            </div>-->
            <div class="zone23" onclick="sendWS('s38_z2_3')">
                <!-- Zone2.3-->
                 Tous les autres bateaux de la flottes.
            </div>
        </div>
        <!-- Ajout du script qui défini les tailles des divs -->
        <script src="scripts/resizeZonesScene38.js"></script>

        <!-- Code à rajouter à chaque page-->
    <script>
        window.addEventListener('DOMContentLoaded', () => {
          console.log('sendWS =', typeof window.sendWS);
        });
      </script>
            <style>
              /* Bloquer clics sur toutes les zones sans overlay */
              div[class^="zone"]:not(.zone-has-overlay),
              div[class*=" zone"]:not(.zone-has-overlay) {
                pointer-events: none !important;
              }
              
              /* Zones reconnues par l’extension restent cliquables */
              div.zone-has-overlay {
                pointer-events: auto !important;
              }
              </style>
              <script>
                /* Stoppe les doubles clics sur zones superposées
                   en respectant l’extension qui toggle .zone-has-overlay */
                (function () {
                  const handlers = new WeakMap();
                
                  function arm(el) {
                    if (handlers.has(el)) return;
                    const h = (e) => {
                      // Laisse le onclick de CETTE zone s’exécuter,
                      // mais bloque la bulle vers les parents.
                      e.stopPropagation();
                    };
                    handlers.set(el, h);
                    el.addEventListener('click', h, false); // phase bulle
                  }
                
                  function disarm(el) {
                    const h = handlers.get(el);
                    if (!h) return;
                    el.removeEventListener('click', h, false);
                    handlers.delete(el);
                  }
                
                  function scan(root = document) {
                    root.querySelectorAll('.zone-has-overlay').forEach(arm);
                  }
                
                  const mo = new MutationObserver((muts) => {
                    for (const m of muts) {
                      if (m.type === 'attributes' && m.attributeName === 'class') {
                        const el = m.target;
                        if (!(el instanceof Element)) continue;
                        if (el.classList.contains('zone-has-overlay')) arm(el);
                        else disarm(el);
                      }
                      if (m.type === 'childList') {
                        m.addedNodes.forEach((n) => {
                          if (n.nodeType !== 1) return;
                          const el = /** @type {Element} */ (n);
                          if (el.classList?.contains('zone-has-overlay')) arm(el);
                          el.querySelectorAll?.('.zone-has-overlay').forEach(arm);
                        });
                        m.removedNodes.forEach((n) => {
                          if (n.nodeType !== 1) return;
                          const el = /** @type {Element} */ (n);
                          if (el.classList?.contains('zone-has-overlay')) disarm(el);
                          el.querySelectorAll?.('.zone-has-overlay').forEach(disarm);
                        });
                      }
                    }
                  });
                
                  mo.observe(document.documentElement, {
                    subtree: true,
                    childList: true,
                    attributes: true,
                    attributeFilter: ['class'],
                  });
                
                  if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => scan(), { once: true });
                  } else {
                    scan();
                  }
                })();
                </script>
              <style>
              /* debug visuel (optionnel) */
              .no-plugin-match { outline: 2px dashed rgba(255,0,0,.35); }
              </style>

    </body>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            /* Ajout de l'image comme image de fond, sans répétition et centrée */
            background: url('images/38.png') no-repeat center center fixed;
            /* "contain" permet d'avoir l'image qui est toujours entièrement visible peu importe la taille de la fenetre et sans déformation */
            background-size: contain;
        }
        div{
            font-size: 5%; /*la taille des textes est adapté à la taille de chaque zone */
        }
        /* Style pour toutes les zones */
         .zone1 {
            position: absolute;
            /*box-sizing: border-box; /* Inclut la bordure dans la taille */
            /*border: 2px dashed red;*/
            /*background-color: rgba(255, 0, 0, 0.1);*/
        }
        /* Style pour les tests */
        .zone2, .zone21, .zone22, .zone221, .zone222, .zone23{
            position: absolute;
            /*border: 2px dashed blue;
            background-color: rgba(0, 0, 255, 0.1);
            box-sizing: border-box; /* Inclut la bordure dans la taille */
        }
        /* Style pour le bouton  */
        .nextScene, .previousScene {
        position: absolute;
        background-color: rgba(229, 229, 229, 0.381);
        color: grey;
        font-size: 120%;
        border: none;
        cursor: pointer;
    }

    
    </style>
</html>